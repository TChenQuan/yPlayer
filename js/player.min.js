"use strict";Vue.config.debug=!0;var vm=new Vue({el:"#ym-player",data:{song_name:"",album_name:"",artist_name:"",showlrc:[],musicArray:"",playingMusic:"",playingIndex:"",havevoice:!0,playStatus:!0,prevIndex:"",prevMusic:"",followIndex:"",followMusic:"",volume:.5,curtime:"00:00",musictime:"00:00",loaded:!1},created:function(){this.loadMusic()},methods:{getJSON:function(e){var t=new Promise(function(t,s){function i(){4===this.readyState&&(200===this.status?t(this.response):s(new Error(this.statusText)))}var r=new XMLHttpRequest;r.open("GET",e),r.onreadystatechange=i,r.responseType="json",r.setRequestHeader("Accept","application/json"),r.send()});return t},changePlay:function(){0==this.playStatus?(this.playStatus=!0,this.$els.mplayer.play()):(this.playStatus=!1,this.$els.mplayer.pause())},loadMusic:function(e){var t=e?"getSong.php?id="+e:"getSong.php?id=0";this.getJSON(t).then(function(e){vm.musicArray=e.tracks,vm.musicLength=vm.musicArray.length,vm.$els.album.style.backgroundImage="url("+e.cover+")","no"!=e.lrc?vm.showlrc=e.lrc:vm.showlrc={0:"暂无歌词"},vm.song_name=e.music_name,vm.album_name=e.album_name,vm.artist_name=e.artists,vm.playingMusic=e.id,vm.playingIndex=e.index,vm.loaded=!0,vm.$els.mplayer.setAttribute("src",e.mp3),vm.$els.mplayer.volume=.5,vm.$els.mplayer.play()},function(e){alert("服务器通信异常")})},changeVoice:function(e){this.$els.mplayer.volume=e.target.value/10,0==e.target.value?this.havevoice=!1:(this.havevoice=!0,this.volume=e.target.value)},changeSound:function(){1==this.havevoice?(this.havevoice=!1,this.$els.mplayer.volume=0,this.$els.soundrange.value=0):(this.havevoice=!0,this.$els.mplayer.volume=this.volume/10,this.$els.soundrange.value=this.volume)},checkStatus:function(){return 0!=this.$els.mplayer.buffered.length},nextMusic:function(){var e,t;this.followMusic&&this.followIndex?(e=this.followIndex,t=this.followMusic):(e=Math.ceil(Math.random()*this.musicLength),t=this.musicArray[e].id),this.followIndex="",this.followMusic="",this.prevMusic=this.playingMusic,this.prevIndex=this.playingIndex,this.showlrc=[],this.getJSON("getLyrics.php?id="+t).then(function(e){"no"!=e.lrc?vm.showlrc=e.lrc:vm.showlrc={0:"暂无歌词"}},function(e){alert("服务器通信异常")});var s="";for(var i in this.musicArray[e].artists)s+=this.musicArray[e].artists[i].name;this.$els.album.style.backgroundImage="url("+this.musicArray[e].album.picUrl+")",this.playingMusic=this.musicArray[e].id,this.playingIndex=e,this.song_name=this.musicArray[e].name,this.album_name=this.musicArray[e].album.name,this.artist_name=s;var r=this.musicArray[e].mp3Url;this.$els.mplayer.setAttribute("src",r),this.$els.mplayer.volume=.5,this.$els.mplayer.play(),this.playStatus=!0},backMusic:function(){if(!this.prevMusic||!this.prevIndex)return!1;this.followIndex=this.playingIndex,this.followMusic=this.playingMusic,this.showlrc=[],this.getJSON("getLyrics.php?id="+this.prevMusic).then(function(e){"no"!=e.lrc?vm.showlrc=e.lrc:vm.showlrc={0:"暂无歌词"}},function(e){alert("服务器通信异常")});var e="";for(var t in this.musicArray[this.prevIndex].artists)e+=this.musicArray[this.prevIndex].artists[t].name;this.$els.album.style.backgroundImage="url("+this.musicArray[this.prevIndex].album.picUrl+")",this.playingMusic=this.musicArray[this.prevIndex].id,this.playingIndex=this.prevIndex,this.song_name=this.musicArray[this.prevIndex].name,this.album_name=this.musicArray[this.prevIndex].album.name,this.artist_name=e;var s=this.musicArray[this.prevIndex].mp3Url;this.prevMusic="",this.prevIndex="",this.$els.mplayer.setAttribute("src",s),this.$els.mplayer.volume=.5,this.$els.mplayer.play(),this.playStatus=!0},getMusic:function(){var e=void 0,t=void 0,s=parseInt(this.$els.mplayer.duration/60);t=s.toString().length>1?""+s:"0"+s;var i=parseInt(this.$els.mplayer.duration%60);e=i.toString().length>1?""+i:"0"+i,this.musictime=t+":"+e},playEvent:function(){if(!this.checkStatus())return!1;var e=void 0,t=void 0,s=parseInt(this.$els.mplayer.currentTime/60);t=s.toString().length>1?""+s:"0"+s;var i=parseInt(this.$els.mplayer.currentTime%60);e=i.toString().length>1?""+i:"0"+i,this.curtime=t+":"+e;var r=Math.floor(this.$els.mplayer.currentTime).toString();this.display_lrc(r);var a=this.$els.mplayer.buffered.end(0)/this.$els.mplayer.duration,l=this.$els.mplayer.currentTime/this.$els.mplayer.duration;this.$els.buffer.style.transform="scaleX("+a+")",this.$els.playtime.style.transform="scaleX("+l+")"},changeProgress:function(e){if(!this.checkStatus())return!1;var t=e.clientX-this.$els.progress.getBoundingClientRect().left;this.$els.mplayer.currentTime=parseInt(t/240*this.$els.mplayer.duration)},display_lrc:function(e){if(!this.checkStatus())return!1;for(var t=document.getElementsByClassName("lrc"),s=0;s<t.length;s++)s+1<t.length&&(t[s].getAttribute("dtime")<=this.$els.mplayer.currentTime&&this.$els.mplayer.currentTime<t[s+1].getAttribute("dtime")?(t[s].classList?t[s].classList.add("lrc-current"):t[s].className+=" lrc-current",t[s].offsetTop>200&&(this.$els.lyricbox.scrollTop=t[s].offsetTop-200)):t[s].classList?t[s].classList.remove("lrc-current"):t[s].className=t[s].className.replace(new RegExp("(^|\\b)"+"lrc-current".split(" ").join("|")+"(\\b|$)","gi")," "));t[t.length-1].getAttribute("dtime")<=this.$els.mplayer.currentTime&&(t[t.length-1].classList?t[t.length-1].classList.add("lrc-current"):t[t.length-1].className+=" lrc-current")}}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBsYXllci5qcyJdLCJuYW1lcyI6WyJWdWUiLCJjb25maWciLCJkZWJ1ZyIsInZtIiwiZWwiLCJkYXRhIiwic29uZ19uYW1lIiwiYWxidW1fbmFtZSIsImFydGlzdF9uYW1lIiwic2hvd2xyYyIsIm11c2ljQXJyYXkiLCJwbGF5aW5nTXVzaWMiLCJwbGF5aW5nSW5kZXgiLCJoYXZldm9pY2UiLCJwbGF5U3RhdHVzIiwicHJldkluZGV4IiwicHJldk11c2ljIiwiZm9sbG93SW5kZXgiLCJmb2xsb3dNdXNpYyIsInZvbHVtZSIsImN1cnRpbWUiLCJtdXNpY3RpbWUiLCJsb2FkZWQiLCJjcmVhdGVkIiwidGhpcyIsImxvYWRNdXNpYyIsIm1ldGhvZHMiLCJnZXRKU09OIiwidXJsIiwicHJvbWlzZSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiaGFuZGxlciIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJyZXNwb25zZSIsIkVycm9yIiwic3RhdHVzVGV4dCIsImNsaWVudCIsIlhNTEh0dHBSZXF1ZXN0Iiwib3BlbiIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsInJlc3BvbnNlVHlwZSIsInNldFJlcXVlc3RIZWFkZXIiLCJzZW5kIiwiY2hhbmdlUGxheSIsIiRlbHMiLCJtcGxheWVyIiwicGxheSIsInBhdXNlIiwiaWQiLCJ0aGVuIiwidHJhY2tzIiwibXVzaWNMZW5ndGgiLCJsZW5ndGgiLCJhbGJ1bSIsInN0eWxlIiwiYmFja2dyb3VuZEltYWdlIiwiY292ZXIiLCJscmMiLCIwIiwibXVzaWNfbmFtZSIsImFydGlzdHMiLCJpbmRleCIsInNldEF0dHJpYnV0ZSIsIm1wMyIsImVycm9yIiwiYWxlcnQiLCJjaGFuZ2VWb2ljZSIsImV2ZW50IiwidGFyZ2V0IiwidmFsdWUiLCJjaGFuZ2VTb3VuZCIsInNvdW5kcmFuZ2UiLCJjaGVja1N0YXR1cyIsImJ1ZmZlcmVkIiwibmV4dE11c2ljIiwicmFuZG9tX2luZGV4IiwicmFuZG9tX2lkIiwiTWF0aCIsImNlaWwiLCJyYW5kb20iLCJhcnRpc3RzX25hbWUiLCJpIiwibmFtZSIsInBpY1VybCIsIm1wM19hZGRyZXNzIiwibXAzVXJsIiwiYmFja011c2ljIiwiZ2V0TXVzaWMiLCJtX3NlY29uZCIsInVuZGVmaW5lZCIsIm1fbWludXRlIiwidGVtcF9taW51dGUiLCJwYXJzZUludCIsImR1cmF0aW9uIiwidG9TdHJpbmciLCJ0ZW1wX3NlY29uZCIsInBsYXlFdmVudCIsImNfc2Vjb25kIiwiY19taW51dGUiLCJjdXJyZW50VGltZSIsInBsYXlfdGltZSIsImZsb29yIiwiZGlzcGxheV9scmMiLCJidWZmZXJfcGVyY2VudCIsImVuZCIsImN1cnJlbnRfcGVyY2VudCIsImJ1ZmZlciIsInRyYW5zZm9ybSIsInBsYXl0aW1lIiwiY2hhbmdlUHJvZ3Jlc3MiLCJwcm9ncmVzc1giLCJjbGllbnRYIiwicHJvZ3Jlc3MiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJsZWZ0IiwibHJjcyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImdldEF0dHJpYnV0ZSIsImNsYXNzTGlzdCIsImFkZCIsImNsYXNzTmFtZSIsIm9mZnNldFRvcCIsImx5cmljYm94Iiwic2Nyb2xsVG9wIiwicmVtb3ZlIiwicmVwbGFjZSIsIlJlZ0V4cCIsInNwbGl0Iiwiam9pbiJdLCJtYXBwaW5ncyI6IkFBSUEsWUFFQUEsS0FBSUMsT0FBT0MsT0FBUSxDQUNuQixJQUFJQyxJQUFLLEdBQUlILE1BQ1hJLEdBQUksYUFDSkMsTUFDRUMsVUFBVyxHQUNYQyxXQUFZLEdBQ1pDLFlBQWEsR0FDYkMsV0FDQUMsV0FBWSxHQUNaQyxhQUFjLEdBQ2RDLGFBQWMsR0FDZEMsV0FBVyxFQUNYQyxZQUFZLEVBQ1pDLFVBQVcsR0FDWEMsVUFBVyxHQUNYQyxZQUFhLEdBQ2JDLFlBQWEsR0FDYkMsT0FBUSxHQUNSQyxRQUFTLFFBQ1RDLFVBQVcsUUFDWEMsUUFBUSxHQUVWQyxRQUFTLFdBQ1BDLEtBQUtDLGFBRVBDLFNBTUVDLFFBQVMsU0FBaUJDLEdB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LEtBQUtDLFFBQVFzRCxZQUFjZ0IsRUFBS2xDLEVBQUksR0FBR3FDLGFBQWEsVUFDekhILEVBQUtsQyxHQUFHc0MsVUFDVkosRUFBS2xDLEdBQUdzQyxVQUFVQyxJQUFJLGVBRXRCTCxFQUFLbEMsR0FBR3dDLFdBQWEsZUFFbkJOLEVBQUtsQyxHQUFHeUMsVUFBWSxNQUN0QnJHLEtBQUt1QixLQUFLK0UsU0FBU0MsVUFBWVQsRUFBS2xDLEdBQUd5QyxVQUFZLE1BR2pEUCxFQUFLbEMsR0FBR3NDLFVBQ1ZKLEVBQUtsQyxHQUFHc0MsVUFBVU0sT0FBTyxlQUV6QlYsRUFBS2xDLEdBQUd3QyxVQUFZTixFQUFLbEMsR0FBR3dDLFVBQVVLLFFBQVEsR0FBSUMsUUFBTyxVQUFZLGNBQWNDLE1BQU0sS0FBS0MsS0FBSyxLQUFPLFVBQVcsTUFBTyxLQUtoSWQsR0FBS0EsRUFBSy9ELE9BQVMsR0FBR2tFLGFBQWEsVUFBWWpHLEtBQUt1QixLQUFLQyxRQUFRc0QsY0FDL0RnQixFQUFLQSxFQUFLL0QsT0FBUyxHQUFHbUUsVUFDeEJKLEVBQUtBLEVBQUsvRCxPQUFTLEdBQUdtRSxVQUFVQyxJQUFJLGVBRXBDTCxFQUFLQSxFQUFLL0QsT0FBUyxHQUFHcUUsV0FBYSIsImZpbGUiOiJwbGF5ZXIubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiogeVBsYXllclxuKiBBdXRob3IgeWFuZ3pqMTk5MlxuKi9cblwidXNlIHN0cmljdFwiO1xuXG5WdWUuY29uZmlnLmRlYnVnID0gdHJ1ZTtcbnZhciB2bSA9IG5ldyBWdWUoe1xuICBlbDogJyN5bS1wbGF5ZXInLFxuICBkYXRhOiB7XG4gICAgc29uZ19uYW1lOiAnJyxcbiAgICBhbGJ1bV9uYW1lOiAnJyxcbiAgICBhcnRpc3RfbmFtZTogJycsXG4gICAgc2hvd2xyYzogW10sXG4gICAgbXVzaWNBcnJheTogJycsXG4gICAgcGxheWluZ011c2ljOiAnJyxcbiAgICBwbGF5aW5nSW5kZXg6ICcnLFxuICAgIGhhdmV2b2ljZTogdHJ1ZSxcbiAgICBwbGF5U3RhdHVzOiB0cnVlLFxuICAgIHByZXZJbmRleDogJycsXG4gICAgcHJldk11c2ljOiAnJyxcbiAgICBmb2xsb3dJbmRleDogJycsXG4gICAgZm9sbG93TXVzaWM6ICcnLFxuICAgIHZvbHVtZTogMC41LFxuICAgIGN1cnRpbWU6ICcwMDowMCcsXG4gICAgbXVzaWN0aW1lOiAnMDA6MDAnLFxuICAgIGxvYWRlZDogZmFsc2VcbiAgfSxcbiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHtcbiAgICB0aGlzLmxvYWRNdXNpYygpO1xuICB9LFxuICBtZXRob2RzOiB7XG4gICAgLyoqXG4gICAgICogW2dldEpTT04gZ2VuZXJhdGUgQUpBWCByZXF1ZXN0XVxuICAgICAqIEBwYXJhbSAge1tzdHJpbmddfSB1cmwgW3JlcXVlc3QgdXJsXVxuICAgICAqIEByZXR1cm4ge1twcm9taXNlXX0gXG4gICAgICovXG4gICAgZ2V0SlNPTjogZnVuY3Rpb24gZ2V0SlNPTih1cmwpIHtcbiAgICAgIHZhciBwcm9taXNlID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB2YXIgY2xpZW50ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgIGNsaWVudC5vcGVuKFwiR0VUXCIsIHVybCk7XG4gICAgICAgIGNsaWVudC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBoYW5kbGVyO1xuICAgICAgICBjbGllbnQucmVzcG9uc2VUeXBlID0gXCJqc29uXCI7XG4gICAgICAgIGNsaWVudC5zZXRSZXF1ZXN0SGVhZGVyKFwiQWNjZXB0XCIsIFwiYXBwbGljYXRpb24vanNvblwiKTtcbiAgICAgICAgY2xpZW50LnNlbmQoKTtmdW5jdGlvbiBoYW5kbGVyKCkge1xuICAgICAgICAgIGlmICh0aGlzLnJlYWR5U3RhdGUgIT09IDQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9aWYgKHRoaXMuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgIHJlc29sdmUodGhpcy5yZXNwb25zZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IodGhpcy5zdGF0dXNUZXh0KSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIFtjaGFuZ2VQbGF5IFBsYXkgc3RhdHVzIDzigJTigJQ+ICBQYXVzZSBzdGF1dHMgXVxuICAgICAqL1xuICAgIGNoYW5nZVBsYXk6IGZ1bmN0aW9uIGNoYW5nZVBsYXkoKSB7XG4gICAgICBpZiAodGhpcy5wbGF5U3RhdHVzID09IGZhbHNlKSB7XG4gICAgICAgIHRoaXMucGxheVN0YXR1cyA9IHRydWU7XG4gICAgICAgIHRoaXMuJGVscy5tcGxheWVyLnBsYXkoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucGxheVN0YXR1cyA9IGZhbHNlO1xuICAgICAgICB0aGlzLiRlbHMubXBsYXllci5wYXVzZSgpO1xuICAgICAgfVxuICAgIH0sXG4gICAgLyoqXG4gICAgICogW2xvYWRNdXNpYyBsb2FkIG11c2ljIHdpdGggc29uZyBpZCBvciByYW5kb20gc29uZ11cbiAgICAgKiBAcGFyYW0gIHtbaW50XX0gaWQgW05ldGVhc2Ugc29uZyBpZF1cbiAgICAgKi9cbiAgICBsb2FkTXVzaWM6IGZ1bmN0aW9uIGxvYWRNdXNpYyhpZCkge1xuICAgICAgdmFyIHVybCA9IGlkID8gJ2dldFNvbmcucGhwP2lkPScgKyBpZCA6ICdnZXRTb25nLnBocD9pZD0wJztcbiAgICAgIHRoaXMuZ2V0SlNPTih1cmwpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgdm0ubXVzaWNBcnJheSA9IGRhdGEudHJhY2tzO1xuICAgICAgICB2bS5tdXNpY0xlbmd0aCA9IHZtLm11c2ljQXJyYXkubGVuZ3RoO1xuICAgICAgICB2bS4kZWxzLmFsYnVtLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9ICd1cmwoJyArIGRhdGEuY292ZXIgKyAnKSc7XG4gICAgICAgIGlmIChkYXRhLmxyYyAhPSBcIm5vXCIpIHtcbiAgICAgICAgICB2bS5zaG93bHJjID0gZGF0YS5scmM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdm0uc2hvd2xyYyA9IHsgXCIwXCI6IFwi5pqC5peg5q2M6K+NXCIgfTtcbiAgICAgICAgfVxuICAgICAgICB2bS5zb25nX25hbWUgPSBkYXRhLm11c2ljX25hbWU7XG4gICAgICAgIHZtLmFsYnVtX25hbWUgPSBkYXRhLmFsYnVtX25hbWU7XG4gICAgICAgIHZtLmFydGlzdF9uYW1lID0gZGF0YS5hcnRpc3RzO1xuICAgICAgICB2bS5wbGF5aW5nTXVzaWMgPSBkYXRhLmlkO1xuICAgICAgICB2bS5wbGF5aW5nSW5kZXggPSBkYXRhLmluZGV4O1xuICAgICAgICB2bS5sb2FkZWQgPSB0cnVlO1xuICAgICAgICB2bS4kZWxzLm1wbGF5ZXIuc2V0QXR0cmlidXRlKFwic3JjXCIsIGRhdGEubXAzKTtcbiAgICAgICAgdm0uJGVscy5tcGxheWVyLnZvbHVtZSA9IDAuNTtcbiAgICAgICAgdm0uJGVscy5tcGxheWVyLnBsYXkoKTtcbiAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICBhbGVydCgn5pyN5Yqh5Zmo6YCa5L+h5byC5bi4Jyk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIFtjaGFuZ2VWb2ljZSBjaGFuZ2UgcGxheWVyICdzIHZvbHVtZSBdXG4gICAgICovXG4gICAgY2hhbmdlVm9pY2U6IGZ1bmN0aW9uIGNoYW5nZVZvaWNlKGV2ZW50KSB7XG4gICAgICB0aGlzLiRlbHMubXBsYXllci52b2x1bWUgPSBldmVudC50YXJnZXQudmFsdWUgLyAxMDtcbiAgICAgIGlmIChldmVudC50YXJnZXQudmFsdWUgPT0gMCkge1xuICAgICAgICB0aGlzLmhhdmV2b2ljZSA9IGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5oYXZldm9pY2UgPSB0cnVlO1xuICAgICAgICB0aGlzLnZvbHVtZSA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8qKlxuICAgICAqIFtjaGFuZ2VTb3VuZCBtdXRlIDzigJTigJQ+IHVzZWQgdm9sdW1uXVxuICAgICAqL1xuICAgIGNoYW5nZVNvdW5kOiBmdW5jdGlvbiBjaGFuZ2VTb3VuZCgpIHtcbiAgICAgIGlmICh0aGlzLmhhdmV2b2ljZSA9PSB0cnVlKSB7XG4gICAgICAgIHRoaXMuaGF2ZXZvaWNlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuJGVscy5tcGxheWVyLnZvbHVtZSA9IDA7XG4gICAgICAgIHRoaXMuJGVscy5zb3VuZHJhbmdlLnZhbHVlID0gMDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuaGF2ZXZvaWNlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy4kZWxzLm1wbGF5ZXIudm9sdW1lID0gdGhpcy52b2x1bWUgLyAxMDtcbiAgICAgICAgdGhpcy4kZWxzLnNvdW5kcmFuZ2UudmFsdWUgPSB0aGlzLnZvbHVtZTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8qKlxuICAgICAqIFtjaGVja1N0YXR1cyBjaGVjayBzb25nJ3MgbG9hZGluZyBzdGF0dXNdXG4gICAgICogQHJldHVybiB7W2Jvb2xlYW5dfVxuICAgICAqL1xuICAgIGNoZWNrU3RhdHVzOiBmdW5jdGlvbiBjaGVja1N0YXR1cygpIHtcbiAgICAgIGlmICh0aGlzLiRlbHMubXBsYXllci5idWZmZXJlZC5sZW5ndGggPT0gMCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG5leHRNdXNpYzogZnVuY3Rpb24gbmV4dE11c2ljKCkge1xuICAgICAgdmFyIHJhbmRvbV9pbmRleDtcbiAgICAgIHZhciByYW5kb21faWQ7XG4gICAgICBpZiAoIXRoaXMuZm9sbG93TXVzaWMgfHwgIXRoaXMuZm9sbG93SW5kZXgpIHtcbiAgICAgICAgcmFuZG9tX2luZGV4ID0gTWF0aC5jZWlsKE1hdGgucmFuZG9tKCkgKiB0aGlzLm11c2ljTGVuZ3RoKTtcbiAgICAgICAgcmFuZG9tX2lkID0gdGhpcy5tdXNpY0FycmF5W3JhbmRvbV9pbmRleF0uaWQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByYW5kb21faW5kZXggPSB0aGlzLmZvbGxvd0luZGV4O1xuICAgICAgICByYW5kb21faWQgPSB0aGlzLmZvbGxvd011c2ljO1xuICAgICAgfVxuICAgICAgdGhpcy5mb2xsb3dJbmRleCA9ICcnO1xuICAgICAgdGhpcy5mb2xsb3dNdXNpYyA9ICcnO1xuICAgICAgdGhpcy5wcmV2TXVzaWMgPSB0aGlzLnBsYXlpbmdNdXNpYztcbiAgICAgIHRoaXMucHJldkluZGV4ID0gdGhpcy5wbGF5aW5nSW5kZXg7XG4gICAgICB0aGlzLnNob3dscmMgPSBbXTtcbiAgICAgIHRoaXMuZ2V0SlNPTignZ2V0THlyaWNzLnBocD9pZD0nICsgcmFuZG9tX2lkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIGlmIChkYXRhLmxyYyAhPSBcIm5vXCIpIHtcbiAgICAgICAgICB2bS5zaG93bHJjID0gZGF0YS5scmM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdm0uc2hvd2xyYyA9IHsgXCIwXCI6IFwi5pqC5peg5q2M6K+NXCIgfTtcbiAgICAgICAgfVxuICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIGFsZXJ0KCfmnI3liqHlmajpgJrkv6HlvILluLgnKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGFydGlzdHNfbmFtZSA9ICcnO1xuICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLm11c2ljQXJyYXlbcmFuZG9tX2luZGV4XS5hcnRpc3RzKSB7XG4gICAgICAgIGFydGlzdHNfbmFtZSArPSB0aGlzLm11c2ljQXJyYXlbcmFuZG9tX2luZGV4XS5hcnRpc3RzW2ldLm5hbWU7XG4gICAgICB9XG4gICAgICB0aGlzLiRlbHMuYWxidW0uc3R5bGUuYmFja2dyb3VuZEltYWdlID0gJ3VybCgnICsgdGhpcy5tdXNpY0FycmF5W3JhbmRvbV9pbmRleF0uYWxidW0ucGljVXJsICsgJyknO1xuICAgICAgdGhpcy5wbGF5aW5nTXVzaWMgPSB0aGlzLm11c2ljQXJyYXlbcmFuZG9tX2luZGV4XS5pZDtcbiAgICAgIHRoaXMucGxheWluZ0luZGV4ID0gcmFuZG9tX2luZGV4O1xuICAgICAgdGhpcy5zb25nX25hbWUgPSB0aGlzLm11c2ljQXJyYXlbcmFuZG9tX2luZGV4XS5uYW1lO1xuICAgICAgdGhpcy5hbGJ1bV9uYW1lID0gdGhpcy5tdXNpY0FycmF5W3JhbmRvbV9pbmRleF0uYWxidW0ubmFtZTtcbiAgICAgIHRoaXMuYXJ0aXN0X25hbWUgPSBhcnRpc3RzX25hbWU7XG4gICAgICB2YXIgbXAzX2FkZHJlc3MgPSB0aGlzLm11c2ljQXJyYXlbcmFuZG9tX2luZGV4XS5tcDNVcmw7XG4gICAgICB0aGlzLiRlbHMubXBsYXllci5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgbXAzX2FkZHJlc3MpO1xuICAgICAgdGhpcy4kZWxzLm1wbGF5ZXIudm9sdW1lID0gMC41O1xuICAgICAgdGhpcy4kZWxzLm1wbGF5ZXIucGxheSgpO1xuICAgICAgdGhpcy5wbGF5U3RhdHVzID0gdHJ1ZTtcbiAgICB9LFxuICAgIGJhY2tNdXNpYzogZnVuY3Rpb24gYmFja011c2ljKCkge1xuICAgICAgaWYgKCF0aGlzLnByZXZNdXNpYyB8fCAhdGhpcy5wcmV2SW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgdGhpcy5mb2xsb3dJbmRleCA9IHRoaXMucGxheWluZ0luZGV4O1xuICAgICAgdGhpcy5mb2xsb3dNdXNpYyA9IHRoaXMucGxheWluZ011c2ljO1xuICAgICAgdGhpcy5zaG93bHJjID0gW107XG4gICAgICB0aGlzLmdldEpTT04oJ2dldEx5cmljcy5waHA/aWQ9JyArIHRoaXMucHJldk11c2ljKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIGlmIChkYXRhLmxyYyAhPSBcIm5vXCIpIHtcbiAgICAgICAgICB2bS5zaG93bHJjID0gZGF0YS5scmM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdm0uc2hvd2xyYyA9IHsgXCIwXCI6IFwi5pqC5peg5q2M6K+NXCIgfTtcbiAgICAgICAgfVxuICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIGFsZXJ0KCfmnI3liqHlmajpgJrkv6HlvILluLgnKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGFydGlzdHNfbmFtZSA9ICcnO1xuICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLm11c2ljQXJyYXlbdGhpcy5wcmV2SW5kZXhdLmFydGlzdHMpIHtcbiAgICAgICAgYXJ0aXN0c19uYW1lICs9IHRoaXMubXVzaWNBcnJheVt0aGlzLnByZXZJbmRleF0uYXJ0aXN0c1tpXS5uYW1lO1xuICAgICAgfVxuICAgICAgdGhpcy4kZWxzLmFsYnVtLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9ICd1cmwoJyArIHRoaXMubXVzaWNBcnJheVt0aGlzLnByZXZJbmRleF0uYWxidW0ucGljVXJsICsgJyknO1xuICAgICAgdGhpcy5wbGF5aW5nTXVzaWMgPSB0aGlzLm11c2ljQXJyYXlbdGhpcy5wcmV2SW5kZXhdLmlkO1xuICAgICAgdGhpcy5wbGF5aW5nSW5kZXggPSB0aGlzLnByZXZJbmRleDtcbiAgICAgIHRoaXMuc29uZ19uYW1lID0gdGhpcy5tdXNpY0FycmF5W3RoaXMucHJldkluZGV4XS5uYW1lO1xuICAgICAgdGhpcy5hbGJ1bV9uYW1lID0gdGhpcy5tdXNpY0FycmF5W3RoaXMucHJldkluZGV4XS5hbGJ1bS5uYW1lO1xuICAgICAgdGhpcy5hcnRpc3RfbmFtZSA9IGFydGlzdHNfbmFtZTtcbiAgICAgIHZhciBtcDNfYWRkcmVzcyA9IHRoaXMubXVzaWNBcnJheVt0aGlzLnByZXZJbmRleF0ubXAzVXJsO1xuICAgICAgdGhpcy5wcmV2TXVzaWMgPSAnJztcbiAgICAgIHRoaXMucHJldkluZGV4ID0gJyc7XG4gICAgICB0aGlzLiRlbHMubXBsYXllci5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgbXAzX2FkZHJlc3MpO1xuICAgICAgdGhpcy4kZWxzLm1wbGF5ZXIudm9sdW1lID0gMC41O1xuICAgICAgdGhpcy4kZWxzLm1wbGF5ZXIucGxheSgpO1xuICAgICAgdGhpcy5wbGF5U3RhdHVzID0gdHJ1ZTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIFtnZXRNdXNpYyBnZXQgbXVzaWMgdGltZV1cbiAgICAgKi9cbiAgICBnZXRNdXNpYzogZnVuY3Rpb24gZ2V0TXVzaWMoKSB7XG4gICAgICB2YXIgbV9zZWNvbmQgPSB1bmRlZmluZWQsXG4gICAgICAgICAgbV9taW51dGUgPSB1bmRlZmluZWQ7XG4gICAgICB2YXIgdGVtcF9taW51dGUgPSBwYXJzZUludCh0aGlzLiRlbHMubXBsYXllci5kdXJhdGlvbiAvIDYwKTtcbiAgICAgIGlmICh0ZW1wX21pbnV0ZS50b1N0cmluZygpLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgbV9taW51dGUgPSAnJyArIHRlbXBfbWludXRlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbV9taW51dGUgPSAnMCcgKyB0ZW1wX21pbnV0ZTtcbiAgICAgIH1cbiAgICAgIHZhciB0ZW1wX3NlY29uZCA9IHBhcnNlSW50KHRoaXMuJGVscy5tcGxheWVyLmR1cmF0aW9uICUgNjApO1xuICAgICAgaWYgKHRlbXBfc2Vjb25kLnRvU3RyaW5nKCkubGVuZ3RoID4gMSkge1xuICAgICAgICBtX3NlY29uZCA9ICcnICsgdGVtcF9zZWNvbmQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtX3NlY29uZCA9ICcwJyArIHRlbXBfc2Vjb25kO1xuICAgICAgfVxuICAgICAgdGhpcy5tdXNpY3RpbWUgPSBtX21pbnV0ZSArICc6JyArIG1fc2Vjb25kO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogW3BsYXlFdmVudCB1cGRhdGUgdGhlIHBsYXlpbmcgc3RhdHVzKHRpbWluZyDjgIFidWZmZXIuLildXG4gICAgICovXG4gICAgcGxheUV2ZW50OiBmdW5jdGlvbiBwbGF5RXZlbnQoKSB7XG4gICAgICBpZiAoIXRoaXMuY2hlY2tTdGF0dXMoKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICB2YXIgY19zZWNvbmQgPSB1bmRlZmluZWQsXG4gICAgICAgICAgY19taW51dGUgPSB1bmRlZmluZWQ7XG4gICAgICB2YXIgdGVtcF9taW51dGUgPSBwYXJzZUludCh0aGlzLiRlbHMubXBsYXllci5jdXJyZW50VGltZSAvIDYwKTtcbiAgICAgIGlmICh0ZW1wX21pbnV0ZS50b1N0cmluZygpLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgY19taW51dGUgPSAnJyArIHRlbXBfbWludXRlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY19taW51dGUgPSAnMCcgKyB0ZW1wX21pbnV0ZTtcbiAgICAgIH1cbiAgICAgIHZhciB0ZW1wX3NlY29uZCA9IHBhcnNlSW50KHRoaXMuJGVscy5tcGxheWVyLmN1cnJlbnRUaW1lICUgNjApO1xuICAgICAgaWYgKHRlbXBfc2Vjb25kLnRvU3RyaW5nKCkubGVuZ3RoID4gMSkge1xuICAgICAgICBjX3NlY29uZCA9ICcnICsgdGVtcF9zZWNvbmQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjX3NlY29uZCA9ICcwJyArIHRlbXBfc2Vjb25kO1xuICAgICAgfVxuICAgICAgdGhpcy5jdXJ0aW1lID0gY19taW51dGUgKyAnOicgKyBjX3NlY29uZDtcbiAgICAgIHZhciBwbGF5X3RpbWUgPSBNYXRoLmZsb29yKHRoaXMuJGVscy5tcGxheWVyLmN1cnJlbnRUaW1lKS50b1N0cmluZygpO1xuICAgICAgdGhpcy5kaXNwbGF5X2xyYyhwbGF5X3RpbWUpO1xuICAgICAgdmFyIGJ1ZmZlcl9wZXJjZW50ID0gdGhpcy4kZWxzLm1wbGF5ZXIuYnVmZmVyZWQuZW5kKDApIC8gdGhpcy4kZWxzLm1wbGF5ZXIuZHVyYXRpb247XG4gICAgICB2YXIgY3VycmVudF9wZXJjZW50ID0gdGhpcy4kZWxzLm1wbGF5ZXIuY3VycmVudFRpbWUgLyB0aGlzLiRlbHMubXBsYXllci5kdXJhdGlvbjtcbiAgICAgIHRoaXMuJGVscy5idWZmZXIuc3R5bGUudHJhbnNmb3JtID0gXCJzY2FsZVgoXCIgKyBidWZmZXJfcGVyY2VudCArIFwiKVwiO1xuICAgICAgdGhpcy4kZWxzLnBsYXl0aW1lLnN0eWxlLnRyYW5zZm9ybSA9IFwic2NhbGVYKFwiICsgY3VycmVudF9wZXJjZW50ICsgXCIpXCI7XG4gICAgfSxcbiAgICBjaGFuZ2VQcm9ncmVzczogZnVuY3Rpb24gY2hhbmdlUHJvZ3Jlc3MoZXZlbnQpIHtcbiAgICAgIGlmICghdGhpcy5jaGVja1N0YXR1cygpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHZhciBwcm9ncmVzc1ggPSBldmVudC5jbGllbnRYIC0gdGhpcy4kZWxzLnByb2dyZXNzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQ7XG4gICAgICB0aGlzLiRlbHMubXBsYXllci5jdXJyZW50VGltZSA9IHBhcnNlSW50KHByb2dyZXNzWCAvIDI0MCAqIHRoaXMuJGVscy5tcGxheWVyLmR1cmF0aW9uKTtcbiAgICB9LFxuICAgIGRpc3BsYXlfbHJjOiBmdW5jdGlvbiBkaXNwbGF5X2xyYyhwbGF5X3RpbWUpIHtcbiAgICAgIGlmICghdGhpcy5jaGVja1N0YXR1cygpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHZhciBscmNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnbHJjJyk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxyY3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGkgKyAxIDwgbHJjcy5sZW5ndGgpIHtcbiAgICAgICAgICBpZiAobHJjc1tpXS5nZXRBdHRyaWJ1dGUoJ2R0aW1lJykgPD0gdGhpcy4kZWxzLm1wbGF5ZXIuY3VycmVudFRpbWUgJiYgdGhpcy4kZWxzLm1wbGF5ZXIuY3VycmVudFRpbWUgPCBscmNzW2kgKyAxXS5nZXRBdHRyaWJ1dGUoJ2R0aW1lJykpIHtcbiAgICAgICAgICAgIGlmIChscmNzW2ldLmNsYXNzTGlzdCkge1xuICAgICAgICAgICAgICBscmNzW2ldLmNsYXNzTGlzdC5hZGQoJ2xyYy1jdXJyZW50Jyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBscmNzW2ldLmNsYXNzTmFtZSArPSAnICcgKyAnbHJjLWN1cnJlbnQnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGxyY3NbaV0ub2Zmc2V0VG9wID4gMjAwKSB7XG4gICAgICAgICAgICAgIHRoaXMuJGVscy5seXJpY2JveC5zY3JvbGxUb3AgPSBscmNzW2ldLm9mZnNldFRvcCAtIDIwMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGxyY3NbaV0uY2xhc3NMaXN0KSB7XG4gICAgICAgICAgICAgIGxyY3NbaV0uY2xhc3NMaXN0LnJlbW92ZSgnbHJjLWN1cnJlbnQnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGxyY3NbaV0uY2xhc3NOYW1lID0gbHJjc1tpXS5jbGFzc05hbWUucmVwbGFjZShuZXcgUmVnRXhwKCcoXnxcXFxcYiknICsgJ2xyYy1jdXJyZW50Jy5zcGxpdCgnICcpLmpvaW4oJ3wnKSArICcoXFxcXGJ8JCknLCAnZ2knKSwgJyAnKTsgLy9pZThcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChscmNzW2xyY3MubGVuZ3RoIC0gMV0uZ2V0QXR0cmlidXRlKCdkdGltZScpIDw9IHRoaXMuJGVscy5tcGxheWVyLmN1cnJlbnRUaW1lKSB7XG4gICAgICAgIGlmIChscmNzW2xyY3MubGVuZ3RoIC0gMV0uY2xhc3NMaXN0KSB7XG4gICAgICAgICAgbHJjc1tscmNzLmxlbmd0aCAtIDFdLmNsYXNzTGlzdC5hZGQoJ2xyYy1jdXJyZW50Jyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbHJjc1tscmNzLmxlbmd0aCAtIDFdLmNsYXNzTmFtZSArPSAnICcgKyAnbHJjLWN1cnJlbnQnO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
