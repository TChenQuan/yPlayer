"use strict";Vue.config.debug=!0;var vm=new Vue({el:"#ym-player",data:{song_name:"",album_name:"",artist_name:"",showlrc:[],musicArray:"",playingMusic:"",playingIndex:"",havevoice:!0,playStatus:!0,prevIndex:"",prevMusic:"",followIndex:"",followMusic:"",volume:.5,curtime:"00:00",musictime:"00:00",loaded:!1},created:function(){this.loadMusic()},methods:{getJSON:function(e){var t=new Promise(function(t,s){function i(){4===this.readyState&&(200===this.status?t(this.response):s(new Error(this.statusText)))}var r=new XMLHttpRequest;r.open("GET",e),r.onreadystatechange=i,r.responseType="json",r.setRequestHeader("Accept","application/json"),r.send()});return t},changePlay:function(){0==this.playStatus?(this.playStatus=!0,this.$els.mplayer.play()):(this.playStatus=!1,this.$els.mplayer.pause())},loadMusic:function(e){var t=e?"getSong.php?id="+e:"getSong.php?id=0";this.getJSON(t).then(function(e){vm.musicArray=e.tracks,vm.musicLength=vm.musicArray.length,vm.$els.album.style.backgroundImage="url("+e.cover+")","no"!=e.lrc?vm.showlrc=e.lrc:vm.showlrc={0:"暂无歌词"},vm.song_name=e.music_name,vm.album_name=e.album_name,vm.artist_name=e.artists,vm.playingMusic=e.id,vm.playingIndex=e.index,vm.loaded=!0,vm.$els.mplayer.setAttribute("src",e.mp3),vm.$els.mplayer.volume=.5,vm.$els.mplayer.play()},function(e){alert("服务器通信异常")})},changeVoice:function(e){this.$els.mplayer.volume=e.target.value/10,0==e.target.value?this.havevoice=!1:(this.havevoice=!0,this.volume=e.target.value)},changeSound:function(){1==this.havevoice?(this.havevoice=!1,this.$els.mplayer.volume=0,this.$els.soundrange.value=0):(this.havevoice=!0,this.$els.mplayer.volume=this.volume/10,this.$els.soundrange.value=this.volume)},nextMusic:function(){var e,t;this.followMusic&&this.followIndex?(e=this.followIndex,t=this.followMusic):(e=Math.ceil(Math.random()*this.musicLength),t=this.musicArray[e].id),this.followIndex="",this.followMusic="",this.prevMusic=this.playingMusic,this.prevIndex=this.playingIndex,this.showlrc=[],this.getJSON("getLyrics.php?id="+t).then(function(e){"no"!=e.lrc?vm.showlrc=e.lrc:vm.showlrc={0:"暂无歌词"}},function(e){alert("服务器通信异常")});var s="";for(var i in this.musicArray[e].artists)s+=this.musicArray[e].artists[i].name;this.$els.album.style.backgroundImage="url("+this.musicArray[e].album.picUrl+")",this.playingMusic=this.musicArray[e].id,this.playingIndex=e,this.song_name=this.musicArray[e].name,this.album_name=this.musicArray[e].album.name,this.artist_name=s;var r=this.musicArray[e].mp3Url;this.$els.mplayer.setAttribute("src",r),this.$els.mplayer.volume=.5,this.$els.mplayer.play(),this.playStatus=!0},backMusic:function(){if(!this.prevMusic||!this.prevIndex)return!1;this.followIndex=this.playingIndex,this.followMusic=this.playingMusic,this.showlrc=[],this.getJSON("getLyrics.php?id="+this.prevMusic).then(function(e){"no"!=e.lrc?vm.showlrc=e.lrc:vm.showlrc={0:"暂无歌词"}},function(e){alert("服务器通信异常")});var e="";for(var t in this.musicArray[this.prevIndex].artists)e+=this.musicArray[this.prevIndex].artists[t].name;this.$els.album.style.backgroundImage="url("+this.musicArray[this.prevIndex].album.picUrl+")",this.playingMusic=this.musicArray[this.prevIndex].id,this.playingIndex=this.prevIndex,this.song_name=this.musicArray[this.prevIndex].name,this.album_name=this.musicArray[this.prevIndex].album.name,this.artist_name=e;var s=this.musicArray[this.prevIndex].mp3Url;this.prevMusic="",this.prevIndex="",this.$els.mplayer.setAttribute("src",s),this.$els.mplayer.volume=.5,this.$els.mplayer.play(),this.playStatus=!0},getMusic:function(){var e=void 0,t=void 0,s=parseInt(this.$els.mplayer.duration/60);t=s.toString().length>1?""+s:"0"+s;var i=parseInt(this.$els.mplayer.duration%60);e=i.toString().length>1?""+i:"0"+i,this.musictime=t+":"+e},playEvent:function(){if(0==this.$els.mplayer.buffered.length)return!1;var e=void 0,t=void 0,s=parseInt(this.$els.mplayer.currentTime/60);t=s.toString().length>1?""+s:"0"+s;var i=parseInt(this.$els.mplayer.currentTime%60);e=i.toString().length>1?""+i:"0"+i,this.curtime=t+":"+e;var r=Math.floor(this.$els.mplayer.currentTime).toString();this.display_lrc(r);var a=this.$els.mplayer.buffered.end(0)/this.$els.mplayer.duration,l=this.$els.mplayer.currentTime/this.$els.mplayer.duration;this.$els.buffer.style.transform="scaleX("+a+")",this.$els.playtime.style.transform="scaleX("+l+")"},changeProgress:function(e){var t=e.clientX-this.$els.progress.getBoundingClientRect().left;this.$els.mplayer.currentTime=parseInt(t/240*this.$els.mplayer.duration)},display_lrc:function(e){if(0==this.$els.mplayer.buffered.length)return!1;for(var t=document.getElementsByClassName("lrc"),s=0;s<t.length;s++)s+1<t.length&&(t[s].getAttribute("dtime")<=this.$els.mplayer.currentTime&&this.$els.mplayer.currentTime<t[s+1].getAttribute("dtime")?(t[s].classList?t[s].classList.add("lrc-current"):t[s].className+=" lrc-current",t[s].offsetTop>200&&(this.$els.lyricbox.scrollTop=t[s].offsetTop-200)):t[s].classList?t[s].classList.remove("lrc-current"):t[s].className=t[s].className.replace(new RegExp("(^|\\b)"+"lrc-current".split(" ").join("|")+"(\\b|$)","gi")," "));t[t.length-1].getAttribute("dtime")<=this.$els.mplayer.currentTime&&(t[t.length-1].classList?t[t.length-1].classList.add("lrc-current"):t[t.length-1].className+=" lrc-current")}}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBsYXllci5qcyJdLCJuYW1lcyI6WyJWdWUiLCJjb25maWciLCJkZWJ1ZyIsInZtIiwiZWwiLCJkYXRhIiwic29uZ19uYW1lIiwiYWxidW1fbmFtZSIsImFydGlzdF9uYW1lIiwic2hvd2xyYyIsIm11c2ljQXJyYXkiLCJwbGF5aW5nTXVzaWMiLCJwbGF5aW5nSW5kZXgiLCJoYXZldm9pY2UiLCJwbGF5U3RhdHVzIiwicHJldkluZGV4IiwicHJldk11c2ljIiwiZm9sbG93SW5kZXgiLCJmb2xsb3dNdXNpYyIsInZvbHVtZSIsImN1cnRpbWUiLCJtdXNpY3RpbWUiLCJsb2FkZWQiLCJjcmVhdGVkIiwidGhpcyIsImxvYWRNdXNpYyIsIm1ldGhvZHMiLCJnZXRKU09OIiwidXJsIiwicHJvbWlzZSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiaGFuZGxlciIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJyZXNwb25zZSIsIkVycm9yIiwic3RhdHVzVGV4dCIsImNsaWVudCIsIlhNTEh0dHBSZXF1ZXN0Iiwib3BlbiIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsInJlc3BvbnNlVHlwZSIsInNldFJlcXVlc3RIZWFkZXIiLCJzZW5kIiwiY2hhbmdlUGxheSIsIiRlbHMiLCJtcGxheWVyIiwicGxheSIsInBhdXNlIiwiaWQiLCJ0aGVuIiwidHJhY2tzIiwibXVzaWNMZW5ndGgiLCJsZW5ndGgiLCJhbGJ1bSIsInN0eWxlIiwiYmFja2dyb3VuZEltYWdlIiwiY292ZXIiLCJscmMiLCIwIiwibXVzaWNfbmFtZSIsImFydGlzdHMiLCJpbmRleCIsInNldEF0dHJpYnV0ZSIsIm1wMyIsImVycm9yIiwiYWxlcnQiLCJjaGFuZ2VWb2ljZSIsImV2ZW50IiwidGFyZ2V0IiwidmFsdWUiLCJjaGFuZ2VTb3VuZCIsInNvdW5kcmFuZ2UiLCJuZXh0TXVzaWMiLCJyYW5kb21faW5kZXgiLCJyYW5kb21faWQiLCJNYXRoIiwiY2VpbCIsInJhbmRvbSIsImFydGlzdHNfbmFtZSIsImkiLCJuYW1lIiwicGljVXJsIiwibXAzX2FkZHJlc3MiLCJtcDNVcmwiLCJiYWNrTXVzaWMiLCJnZXRNdXNpYyIsIm1fc2Vjb25kIiwidW5kZWZpbmVkIiwibV9taW51dGUiLCJ0ZW1wX21pbnV0ZSIsInBhcnNlSW50IiwiZHVyYXRpb24iLCJ0b1N0cmluZyIsInRlbXBfc2Vjb25kIiwicGxheUV2ZW50IiwiYnVmZmVyZWQiLCJjX3NlY29uZCIsImNfbWludXRlIiwiY3VycmVudFRpbWUiLCJwbGF5X3RpbWUiLCJmbG9vciIsImRpc3BsYXlfbHJjIiwiYnVmZmVyX3BlcmNlbnQiLCJlbmQiLCJjdXJyZW50X3BlcmNlbnQiLCJidWZmZXIiLCJ0cmFuc2Zvcm0iLCJwbGF5dGltZSIsImNoYW5nZVByb2dyZXNzIiwicHJvZ3Jlc3NYIiwiY2xpZW50WCIsInByb2dyZXNzIiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwibGVmdCIsImxyY3MiLCJkb2N1bWVudCIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJnZXRBdHRyaWJ1dGUiLCJjbGFzc0xpc3QiLCJhZGQiLCJjbGFzc05hbWUiLCJvZmZzZXRUb3AiLCJseXJpY2JveCIsInNjcm9sbFRvcCIsInJlbW92ZSIsInJlcGxhY2UiLCJSZWdFeHAiLCJzcGxpdCIsImpvaW4iXSwibWFwcGluZ3MiOiJBQUlBLFlBRUFBLEtBQUlDLE9BQU9DLE9BQVEsQ0FDbkIsSUFBSUMsSUFBSyxHQUFJSCxNQUNYSSxHQUFJLGFBQ0pDLE1BQ0VDLFVBQVcsR0FDWEMsV0FBWSxHQUNaQyxZQUFhLEdBQ2JDLFdBQ0FDLFdBQVksR0FDWkMsYUFBYyxHQUNkQyxhQUFjLEdBQ2RDLFdBQVcsRUFDWEMsWUFBWSxFQUNaQyxVQUFXLEdBQ1hDLFVBQVcsR0FDWEMsWUFBYSxHQUNiQyxZQUFhLEdBQ2JDLE9BQVEsR0FDUkMsUUFBUyxRQUNUQyxVQUFXLFFBQ1hDLFFBQVEsR0FFVkMsUUFBUyxXQUNQQyxLQUFLQyxhQUVQQyxTQUNFQyxRQUFTLFNBQWlCQyxHQUN4QixHQUFJQyxHQUFV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Q3pISCxFQUFLbkMsR0FBR3VDLFVBQ1ZKLEVBQUtuQyxHQUFHdUMsVUFBVUMsSUFBSSxlQUV0QkwsRUFBS25DLEdBQUd5QyxXQUFhLGVBRW5CTixFQUFLbkMsR0FBRzBDLFVBQVksTUFDdEJwRyxLQUFLdUIsS0FBSzhFLFNBQVNDLFVBQVlULEVBQUtuQyxHQUFHMEMsVUFBWSxNQUdqRFAsRUFBS25DLEdBQUd1QyxVQUNWSixFQUFLbkMsR0FBR3VDLFVBQVVNLE9BQU8sZUFFekJWLEVBQUtuQyxHQUFHeUMsVUFBWU4sRUFBS25DLEdBQUd5QyxVQUFVSyxRQUFRLEdBQUlDLFFBQU8sVUFBWSxjQUFjQyxNQUFNLEtBQUtDLEtBQUssS0FBTyxVQUFXLE1BQU8sS0FLaElkLEdBQUtBLEVBQUs5RCxPQUFTLEdBQUdpRSxhQUFhLFVBQVloRyxLQUFLdUIsS0FBS0MsUUFBUXFELGNBQy9EZ0IsRUFBS0EsRUFBSzlELE9BQVMsR0FBR2tFLFVBQ3hCSixFQUFLQSxFQUFLOUQsT0FBUyxHQUFHa0UsVUFBVUMsSUFBSSxlQUVwQ0wsRUFBS0EsRUFBSzlELE9BQVMsR0FBR29FLFdBQWEiLCJmaWxlIjoicGxheWVyLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4qIHlQbGF5ZXJcbiogQXV0aG9yIHlhbmd6ajE5OTJcbiovXG5cInVzZSBzdHJpY3RcIjtcblxuVnVlLmNvbmZpZy5kZWJ1ZyA9IHRydWU7XG52YXIgdm0gPSBuZXcgVnVlKHtcbiAgZWw6ICcjeW0tcGxheWVyJyxcbiAgZGF0YToge1xuICAgIHNvbmdfbmFtZTogJycsXG4gICAgYWxidW1fbmFtZTogJycsXG4gICAgYXJ0aXN0X25hbWU6ICcnLFxuICAgIHNob3dscmM6IFtdLFxuICAgIG11c2ljQXJyYXk6ICcnLFxuICAgIHBsYXlpbmdNdXNpYzogJycsXG4gICAgcGxheWluZ0luZGV4OiAnJyxcbiAgICBoYXZldm9pY2U6IHRydWUsXG4gICAgcGxheVN0YXR1czogdHJ1ZSxcbiAgICBwcmV2SW5kZXg6ICcnLFxuICAgIHByZXZNdXNpYzogJycsXG4gICAgZm9sbG93SW5kZXg6ICcnLFxuICAgIGZvbGxvd011c2ljOiAnJyxcbiAgICB2b2x1bWU6IDAuNSxcbiAgICBjdXJ0aW1lOiAnMDA6MDAnLFxuICAgIG11c2ljdGltZTogJzAwOjAwJyxcbiAgICBsb2FkZWQ6IGZhbHNlXG4gIH0sXG4gIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7XG4gICAgdGhpcy5sb2FkTXVzaWMoKTtcbiAgfSxcbiAgbWV0aG9kczoge1xuICAgIGdldEpTT046IGZ1bmN0aW9uIGdldEpTT04odXJsKSB7XG4gICAgICB2YXIgcHJvbWlzZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgdmFyIGNsaWVudCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICBjbGllbnQub3BlbihcIkdFVFwiLCB1cmwpO1xuICAgICAgICBjbGllbnQub25yZWFkeXN0YXRlY2hhbmdlID0gaGFuZGxlcjtcbiAgICAgICAgY2xpZW50LnJlc3BvbnNlVHlwZSA9IFwianNvblwiO1xuICAgICAgICBjbGllbnQuc2V0UmVxdWVzdEhlYWRlcihcIkFjY2VwdFwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XG4gICAgICAgIGNsaWVudC5zZW5kKCk7ZnVuY3Rpb24gaGFuZGxlcigpIHtcbiAgICAgICAgICBpZiAodGhpcy5yZWFkeVN0YXRlICE9PSA0KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfWlmICh0aGlzLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICByZXNvbHZlKHRoaXMucmVzcG9uc2UpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZWplY3QobmV3IEVycm9yKHRoaXMuc3RhdHVzVGV4dCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgfSxcbiAgICBjaGFuZ2VQbGF5OiBmdW5jdGlvbiBjaGFuZ2VQbGF5KCkge1xuICAgICAgaWYgKHRoaXMucGxheVN0YXR1cyA9PSBmYWxzZSkge1xuICAgICAgICB0aGlzLnBsYXlTdGF0dXMgPSB0cnVlO1xuICAgICAgICB0aGlzLiRlbHMubXBsYXllci5wbGF5KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnBsYXlTdGF0dXMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy4kZWxzLm1wbGF5ZXIucGF1c2UoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGxvYWRNdXNpYzogZnVuY3Rpb24gbG9hZE11c2ljKGlkKSB7XG4gICAgICB2YXIgdXJsID0gaWQgPyAnZ2V0U29uZy5waHA/aWQ9JyArIGlkIDogJ2dldFNvbmcucGhwP2lkPTAnO1xuICAgICAgdGhpcy5nZXRKU09OKHVybCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICB2bS5tdXNpY0FycmF5ID0gZGF0YS50cmFja3M7XG4gICAgICAgIHZtLm11c2ljTGVuZ3RoID0gdm0ubXVzaWNBcnJheS5sZW5ndGg7XG4gICAgICAgIHZtLiRlbHMuYWxidW0uc3R5bGUuYmFja2dyb3VuZEltYWdlID0gJ3VybCgnICsgZGF0YS5jb3ZlciArICcpJztcbiAgICAgICAgaWYgKGRhdGEubHJjICE9IFwibm9cIikge1xuICAgICAgICAgIHZtLnNob3dscmMgPSBkYXRhLmxyYztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2bS5zaG93bHJjID0geyBcIjBcIjogXCLmmoLml6DmrYzor41cIiB9O1xuICAgICAgICB9XG4gICAgICAgIHZtLnNvbmdfbmFtZSA9IGRhdGEubXVzaWNfbmFtZTtcbiAgICAgICAgdm0uYWxidW1fbmFtZSA9IGRhdGEuYWxidW1fbmFtZTtcbiAgICAgICAgdm0uYXJ0aXN0X25hbWUgPSBkYXRhLmFydGlzdHM7XG4gICAgICAgIHZtLnBsYXlpbmdNdXNpYyA9IGRhdGEuaWQ7XG4gICAgICAgIHZtLnBsYXlpbmdJbmRleCA9IGRhdGEuaW5kZXg7XG4gICAgICAgIHZtLmxvYWRlZCA9IHRydWU7XG4gICAgICAgIHZtLiRlbHMubXBsYXllci5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgZGF0YS5tcDMpO1xuICAgICAgICB2bS4kZWxzLm1wbGF5ZXIudm9sdW1lID0gMC41O1xuICAgICAgICB2bS4kZWxzLm1wbGF5ZXIucGxheSgpO1xuICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIGFsZXJ0KCfmnI3liqHlmajpgJrkv6HlvILluLgnKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgY2hhbmdlVm9pY2U6IGZ1bmN0aW9uIGNoYW5nZVZvaWNlKGV2ZW50KSB7XG4gICAgICB0aGlzLiRlbHMubXBsYXllci52b2x1bWUgPSBldmVudC50YXJnZXQudmFsdWUgLyAxMDtcbiAgICAgIGlmIChldmVudC50YXJnZXQudmFsdWUgPT0gMCkge1xuICAgICAgICB0aGlzLmhhdmV2b2ljZSA9IGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5oYXZldm9pY2UgPSB0cnVlO1xuICAgICAgICB0aGlzLnZvbHVtZSA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGNoYW5nZVNvdW5kOiBmdW5jdGlvbiBjaGFuZ2VTb3VuZCgpIHtcbiAgICAgIGlmICh0aGlzLmhhdmV2b2ljZSA9PSB0cnVlKSB7XG4gICAgICAgIHRoaXMuaGF2ZXZvaWNlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuJGVscy5tcGxheWVyLnZvbHVtZSA9IDA7XG4gICAgICAgIHRoaXMuJGVscy5zb3VuZHJhbmdlLnZhbHVlID0gMDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuaGF2ZXZvaWNlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy4kZWxzLm1wbGF5ZXIudm9sdW1lID0gdGhpcy52b2x1bWUgLyAxMDtcbiAgICAgICAgdGhpcy4kZWxzLnNvdW5kcmFuZ2UudmFsdWUgPSB0aGlzLnZvbHVtZTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG5leHRNdXNpYzogZnVuY3Rpb24gbmV4dE11c2ljKCkge1xuICAgICAgdmFyIHJhbmRvbV9pbmRleDtcbiAgICAgIHZhciByYW5kb21faWQ7XG4gICAgICBpZiAoIXRoaXMuZm9sbG93TXVzaWMgfHwgIXRoaXMuZm9sbG93SW5kZXgpIHtcbiAgICAgICAgcmFuZG9tX2luZGV4ID0gTWF0aC5jZWlsKE1hdGgucmFuZG9tKCkgKiB0aGlzLm11c2ljTGVuZ3RoKTtcbiAgICAgICAgcmFuZG9tX2lkID0gdGhpcy5tdXNpY0FycmF5W3JhbmRvbV9pbmRleF0uaWQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByYW5kb21faW5kZXggPSB0aGlzLmZvbGxvd0luZGV4O1xuICAgICAgICByYW5kb21faWQgPSB0aGlzLmZvbGxvd011c2ljO1xuICAgICAgfVxuICAgICAgdGhpcy5mb2xsb3dJbmRleCA9ICcnO1xuICAgICAgdGhpcy5mb2xsb3dNdXNpYyA9ICcnO1xuICAgICAgdGhpcy5wcmV2TXVzaWMgPSB0aGlzLnBsYXlpbmdNdXNpYztcbiAgICAgIHRoaXMucHJldkluZGV4ID0gdGhpcy5wbGF5aW5nSW5kZXg7XG4gICAgICB0aGlzLnNob3dscmMgPSBbXTtcbiAgICAgIHRoaXMuZ2V0SlNPTignZ2V0THlyaWNzLnBocD9pZD0nICsgcmFuZG9tX2lkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIGlmIChkYXRhLmxyYyAhPSBcIm5vXCIpIHtcbiAgICAgICAgICB2bS5zaG93bHJjID0gZGF0YS5scmM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdm0uc2hvd2xyYyA9IHsgXCIwXCI6IFwi5pqC5peg5q2M6K+NXCIgfTtcbiAgICAgICAgfVxuICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIGFsZXJ0KCfmnI3liqHlmajpgJrkv6HlvILluLgnKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGFydGlzdHNfbmFtZSA9ICcnO1xuICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLm11c2ljQXJyYXlbcmFuZG9tX2luZGV4XS5hcnRpc3RzKSB7XG4gICAgICAgIGFydGlzdHNfbmFtZSArPSB0aGlzLm11c2ljQXJyYXlbcmFuZG9tX2luZGV4XS5hcnRpc3RzW2ldLm5hbWU7XG4gICAgICB9XG4gICAgICB0aGlzLiRlbHMuYWxidW0uc3R5bGUuYmFja2dyb3VuZEltYWdlID0gJ3VybCgnICsgdGhpcy5tdXNpY0FycmF5W3JhbmRvbV9pbmRleF0uYWxidW0ucGljVXJsICsgJyknO1xuICAgICAgdGhpcy5wbGF5aW5nTXVzaWMgPSB0aGlzLm11c2ljQXJyYXlbcmFuZG9tX2luZGV4XS5pZDtcbiAgICAgIHRoaXMucGxheWluZ0luZGV4ID0gcmFuZG9tX2luZGV4O1xuICAgICAgdGhpcy5zb25nX25hbWUgPSB0aGlzLm11c2ljQXJyYXlbcmFuZG9tX2luZGV4XS5uYW1lO1xuICAgICAgdGhpcy5hbGJ1bV9uYW1lID0gdGhpcy5tdXNpY0FycmF5W3JhbmRvbV9pbmRleF0uYWxidW0ubmFtZTtcbiAgICAgIHRoaXMuYXJ0aXN0X25hbWUgPSBhcnRpc3RzX25hbWU7XG4gICAgICB2YXIgbXAzX2FkZHJlc3MgPSB0aGlzLm11c2ljQXJyYXlbcmFuZG9tX2luZGV4XS5tcDNVcmw7XG4gICAgICB0aGlzLiRlbHMubXBsYXllci5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgbXAzX2FkZHJlc3MpO1xuICAgICAgdGhpcy4kZWxzLm1wbGF5ZXIudm9sdW1lID0gMC41O1xuICAgICAgdGhpcy4kZWxzLm1wbGF5ZXIucGxheSgpO1xuICAgICAgdGhpcy5wbGF5U3RhdHVzID0gdHJ1ZTtcbiAgICB9LFxuICAgIGJhY2tNdXNpYzogZnVuY3Rpb24gYmFja011c2ljKCkge1xuICAgICAgaWYgKCF0aGlzLnByZXZNdXNpYyB8fCAhdGhpcy5wcmV2SW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgdGhpcy5mb2xsb3dJbmRleCA9IHRoaXMucGxheWluZ0luZGV4O1xuICAgICAgdGhpcy5mb2xsb3dNdXNpYyA9IHRoaXMucGxheWluZ011c2ljO1xuICAgICAgdGhpcy5zaG93bHJjID0gW107XG4gICAgICB0aGlzLmdldEpTT04oJ2dldEx5cmljcy5waHA/aWQ9JyArIHRoaXMucHJldk11c2ljKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIGlmIChkYXRhLmxyYyAhPSBcIm5vXCIpIHtcbiAgICAgICAgICB2bS5zaG93bHJjID0gZGF0YS5scmM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdm0uc2hvd2xyYyA9IHsgXCIwXCI6IFwi5pqC5peg5q2M6K+NXCIgfTtcbiAgICAgICAgfVxuICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIGFsZXJ0KCfmnI3liqHlmajpgJrkv6HlvILluLgnKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGFydGlzdHNfbmFtZSA9ICcnO1xuICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLm11c2ljQXJyYXlbdGhpcy5wcmV2SW5kZXhdLmFydGlzdHMpIHtcbiAgICAgICAgYXJ0aXN0c19uYW1lICs9IHRoaXMubXVzaWNBcnJheVt0aGlzLnByZXZJbmRleF0uYXJ0aXN0c1tpXS5uYW1lO1xuICAgICAgfVxuICAgICAgdGhpcy4kZWxzLmFsYnVtLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9ICd1cmwoJyArIHRoaXMubXVzaWNBcnJheVt0aGlzLnByZXZJbmRleF0uYWxidW0ucGljVXJsICsgJyknO1xuICAgICAgdGhpcy5wbGF5aW5nTXVzaWMgPSB0aGlzLm11c2ljQXJyYXlbdGhpcy5wcmV2SW5kZXhdLmlkO1xuICAgICAgdGhpcy5wbGF5aW5nSW5kZXggPSB0aGlzLnByZXZJbmRleDtcbiAgICAgIHRoaXMuc29uZ19uYW1lID0gdGhpcy5tdXNpY0FycmF5W3RoaXMucHJldkluZGV4XS5uYW1lO1xuICAgICAgdGhpcy5hbGJ1bV9uYW1lID0gdGhpcy5tdXNpY0FycmF5W3RoaXMucHJldkluZGV4XS5hbGJ1bS5uYW1lO1xuICAgICAgdGhpcy5hcnRpc3RfbmFtZSA9IGFydGlzdHNfbmFtZTtcbiAgICAgIHZhciBtcDNfYWRkcmVzcyA9IHRoaXMubXVzaWNBcnJheVt0aGlzLnByZXZJbmRleF0ubXAzVXJsO1xuICAgICAgdGhpcy5wcmV2TXVzaWMgPSAnJztcbiAgICAgIHRoaXMucHJldkluZGV4ID0gJyc7XG4gICAgICB0aGlzLiRlbHMubXBsYXllci5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgbXAzX2FkZHJlc3MpO1xuICAgICAgdGhpcy4kZWxzLm1wbGF5ZXIudm9sdW1lID0gMC41O1xuICAgICAgdGhpcy4kZWxzLm1wbGF5ZXIucGxheSgpO1xuICAgICAgdGhpcy5wbGF5U3RhdHVzID0gdHJ1ZTtcbiAgICB9LFxuICAgIGdldE11c2ljOiBmdW5jdGlvbiBnZXRNdXNpYygpIHtcbiAgICAgIHZhciBtX3NlY29uZCA9IHVuZGVmaW5lZCxcbiAgICAgICAgICBtX21pbnV0ZSA9IHVuZGVmaW5lZDtcbiAgICAgIHZhciB0ZW1wX21pbnV0ZSA9IHBhcnNlSW50KHRoaXMuJGVscy5tcGxheWVyLmR1cmF0aW9uIC8gNjApO1xuICAgICAgaWYgKHRlbXBfbWludXRlLnRvU3RyaW5nKCkubGVuZ3RoID4gMSkge1xuICAgICAgICBtX21pbnV0ZSA9ICcnICsgdGVtcF9taW51dGU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtX21pbnV0ZSA9ICcwJyArIHRlbXBfbWludXRlO1xuICAgICAgfVxuICAgICAgdmFyIHRlbXBfc2Vjb25kID0gcGFyc2VJbnQodGhpcy4kZWxzLm1wbGF5ZXIuZHVyYXRpb24gJSA2MCk7XG4gICAgICBpZiAodGVtcF9zZWNvbmQudG9TdHJpbmcoKS5sZW5ndGggPiAxKSB7XG4gICAgICAgIG1fc2Vjb25kID0gJycgKyB0ZW1wX3NlY29uZDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1fc2Vjb25kID0gJzAnICsgdGVtcF9zZWNvbmQ7XG4gICAgICB9XG4gICAgICB0aGlzLm11c2ljdGltZSA9IG1fbWludXRlICsgJzonICsgbV9zZWNvbmQ7XG4gICAgfSxcbiAgICBwbGF5RXZlbnQ6IGZ1bmN0aW9uIHBsYXlFdmVudCgpIHtcbiAgICAgIGlmICh0aGlzLiRlbHMubXBsYXllci5idWZmZXJlZC5sZW5ndGggPT0gMCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICB2YXIgY19zZWNvbmQgPSB1bmRlZmluZWQsXG4gICAgICAgICAgY19taW51dGUgPSB1bmRlZmluZWQ7XG4gICAgICB2YXIgdGVtcF9taW51dGUgPSBwYXJzZUludCh0aGlzLiRlbHMubXBsYXllci5jdXJyZW50VGltZSAvIDYwKTtcbiAgICAgIGlmICh0ZW1wX21pbnV0ZS50b1N0cmluZygpLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgY19taW51dGUgPSAnJyArIHRlbXBfbWludXRlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY19taW51dGUgPSAnMCcgKyB0ZW1wX21pbnV0ZTtcbiAgICAgIH1cbiAgICAgIHZhciB0ZW1wX3NlY29uZCA9IHBhcnNlSW50KHRoaXMuJGVscy5tcGxheWVyLmN1cnJlbnRUaW1lICUgNjApO1xuICAgICAgaWYgKHRlbXBfc2Vjb25kLnRvU3RyaW5nKCkubGVuZ3RoID4gMSkge1xuICAgICAgICBjX3NlY29uZCA9ICcnICsgdGVtcF9zZWNvbmQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjX3NlY29uZCA9ICcwJyArIHRlbXBfc2Vjb25kO1xuICAgICAgfVxuICAgICAgdGhpcy5jdXJ0aW1lID0gY19taW51dGUgKyAnOicgKyBjX3NlY29uZDtcbiAgICAgIHZhciBwbGF5X3RpbWUgPSBNYXRoLmZsb29yKHRoaXMuJGVscy5tcGxheWVyLmN1cnJlbnRUaW1lKS50b1N0cmluZygpO1xuICAgICAgdGhpcy5kaXNwbGF5X2xyYyhwbGF5X3RpbWUpO1xuICAgICAgdmFyIGJ1ZmZlcl9wZXJjZW50ID0gdGhpcy4kZWxzLm1wbGF5ZXIuYnVmZmVyZWQuZW5kKDApIC8gdGhpcy4kZWxzLm1wbGF5ZXIuZHVyYXRpb247XG4gICAgICB2YXIgY3VycmVudF9wZXJjZW50ID0gdGhpcy4kZWxzLm1wbGF5ZXIuY3VycmVudFRpbWUgLyB0aGlzLiRlbHMubXBsYXllci5kdXJhdGlvbjtcbiAgICAgIHRoaXMuJGVscy5idWZmZXIuc3R5bGUudHJhbnNmb3JtID0gXCJzY2FsZVgoXCIgKyBidWZmZXJfcGVyY2VudCArIFwiKVwiO1xuICAgICAgdGhpcy4kZWxzLnBsYXl0aW1lLnN0eWxlLnRyYW5zZm9ybSA9IFwic2NhbGVYKFwiICsgY3VycmVudF9wZXJjZW50ICsgXCIpXCI7XG4gICAgfSxcbiAgICBjaGFuZ2VQcm9ncmVzczogZnVuY3Rpb24gY2hhbmdlUHJvZ3Jlc3MoZXZlbnQpIHtcbiAgICAgIHZhciBwcm9ncmVzc1ggPSBldmVudC5jbGllbnRYIC0gdGhpcy4kZWxzLnByb2dyZXNzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQ7XG4gICAgICB0aGlzLiRlbHMubXBsYXllci5jdXJyZW50VGltZSA9IHBhcnNlSW50KHByb2dyZXNzWCAvIDI0MCAqIHRoaXMuJGVscy5tcGxheWVyLmR1cmF0aW9uKTtcbiAgICB9LFxuICAgIGRpc3BsYXlfbHJjOiBmdW5jdGlvbiBkaXNwbGF5X2xyYyhwbGF5X3RpbWUpIHtcbiAgICAgIGlmICh0aGlzLiRlbHMubXBsYXllci5idWZmZXJlZC5sZW5ndGggPT0gMCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICB2YXIgbHJjcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2xyYycpO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBscmNzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChpICsgMSA8IGxyY3MubGVuZ3RoKSB7XG4gICAgICAgICAgaWYgKGxyY3NbaV0uZ2V0QXR0cmlidXRlKCdkdGltZScpIDw9IHRoaXMuJGVscy5tcGxheWVyLmN1cnJlbnRUaW1lICYmIHRoaXMuJGVscy5tcGxheWVyLmN1cnJlbnRUaW1lIDwgbHJjc1tpICsgMV0uZ2V0QXR0cmlidXRlKCdkdGltZScpKSB7XG4gICAgICAgICAgICBpZiAobHJjc1tpXS5jbGFzc0xpc3QpIHtcbiAgICAgICAgICAgICAgbHJjc1tpXS5jbGFzc0xpc3QuYWRkKCdscmMtY3VycmVudCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbHJjc1tpXS5jbGFzc05hbWUgKz0gJyAnICsgJ2xyYy1jdXJyZW50JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChscmNzW2ldLm9mZnNldFRvcCA+IDIwMCkge1xuICAgICAgICAgICAgICB0aGlzLiRlbHMubHlyaWNib3guc2Nyb2xsVG9wID0gbHJjc1tpXS5vZmZzZXRUb3AgLSAyMDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChscmNzW2ldLmNsYXNzTGlzdCkge1xuICAgICAgICAgICAgICBscmNzW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2xyYy1jdXJyZW50Jyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBscmNzW2ldLmNsYXNzTmFtZSA9IGxyY3NbaV0uY2xhc3NOYW1lLnJlcGxhY2UobmV3IFJlZ0V4cCgnKF58XFxcXGIpJyArICdscmMtY3VycmVudCcuc3BsaXQoJyAnKS5qb2luKCd8JykgKyAnKFxcXFxifCQpJywgJ2dpJyksICcgJyk7IC8vaWU4XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAobHJjc1tscmNzLmxlbmd0aCAtIDFdLmdldEF0dHJpYnV0ZSgnZHRpbWUnKSA8PSB0aGlzLiRlbHMubXBsYXllci5jdXJyZW50VGltZSkge1xuICAgICAgICBpZiAobHJjc1tscmNzLmxlbmd0aCAtIDFdLmNsYXNzTGlzdCkge1xuICAgICAgICAgIGxyY3NbbHJjcy5sZW5ndGggLSAxXS5jbGFzc0xpc3QuYWRkKCdscmMtY3VycmVudCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxyY3NbbHJjcy5sZW5ndGggLSAxXS5jbGFzc05hbWUgKz0gJyAnICsgJ2xyYy1jdXJyZW50JztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
